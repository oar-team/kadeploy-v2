INSTALLING THE KA DEPLOYMENT SYSTEM


What do you need ?
	- a cluster
	- to be admin of this cluster
	- to get the install package of Ka Deployment System


REQUIREMENTS
============

The system is designed to run on a server enabling deployment on compute nodes.


SYSTEM REQUIREMENTS ON THE SERVER
=================================

Required system tools:
	- Nmap to check if the target nodes are there
	- copy DKsentinelle binary (located in kadeploy2/cookbook/bin) to /usr/local/bin on the server !!!! It is mandatory !!!! see if it works, if not compile taktuk from : http://www-id.imag.fr/Laboratoire/Membres/Martin_Cyrille/taktuk/downloads/taktuk2_0.5-7.tar.gz

Required user's priviledges:
	- user should be allowed to run root commands (for the moment, stronger limitations will then follow), this is only required for changes in the tftp server directory.


CONFIGURATION OF THE CLUSTER
============================

See the HOWTO in Documentation



CONFIGURATION FILES
===================

You need two configuration files that must be put in the /etc/kadeploy/ folder.
Sample of this file are in /share/cookbook/conf/.

1. deploy.conf
--------------
This file presents all the variables the user must defined in order to be able to use the deployment system. It is divided into several sections. A very short description is available for each variable and sometimes exemple values are given in commentary.

2. deploy_cmd.conf
------------------
This file should contain the appropriate reboot and remote console opening commands. The kareboot and kaconsole tools will get the command to execute according to node given in parameter from it. This file is very temporary and may change (even disappear ?) in next development steps.

Also, the user can find exemples of both files in the tools/cookbook folder with a brief description of the syntax to use.


TFTP CONFIGURATION
------------------

#kasetup -createtftp

launch your tftp server, test it !!


INSTALLATION
============


FROM SCRATCH
------------

Install mysql (configure it)
Install dhcpd (configure it)
Install tftp  (configure it)
Install sudo
Install dns (optional)

configure make make install
#./configure --prefix=/usr/local/kadeploy/ --mandir=/usr/share/man && make && make install

copy template configuration file from tools/cookbook/conf/ to /etc/kadeploy/
edit it, read the manual, then check with : 
#kasetup -checkdeployconf

and set correct read/write access (your kadeploy directory must be in 755 mode) :
#kasetup -exportenv
#kasetup -chmodconf

if you don't already have DKsentinelle and mcatseg in /usr/local/bin/ then
#kasetup -copybinfiles

wrap your script with sudo (it's a good ideay for security reason )
#kasetup -printvalidsudoers (put it in /etc/sudoers)
#kasetup -sudowrapping

database schema creation
#kadatabase -addmysqlrights 
#kadatabase -create_db_deploy
#kadatabase -patch21
#kadatabase -patch211

test it with : 
#kaenvironments  -l nobody

edit /etc/kadeploy/clusternodes.conf /etc/kadeploy/clusterpartition.conf then
#kanodes -add

create the tftp folder for pxe
#kasetup -createtftp


It's done !!





FROM Version 2
---------------

configure make make install
#./configure --prefix=/usr/local/kadeploy/ --mandir=/usr/share/man && make && make install

check your conf
#kasetup -checkdeployconf

and set correct read/write access (your kadeploy directory must be in 755 mode): 
#kasetup -exportenv
#kasetup -chmodconf

wrap your script with new sudowrapper (you have to remove old file yourself, it's a bad job, but somebody has to do it)
#kasetup -printvalidsudoers (put it in /etc/sudoers)
#kasetup -sudowrapping

database schema update
#kadatabase -patch21
#kadatabase -patch211

test it with :
#kaenvironments  -l nobody

edit /etc/kadeploy/clusternodes.conf /etc/kadeploy/clusterpartition.conf then
#kanodes -add

It's done !!



FURTHER INFORMATION
===================
For further information, please contact ka-tools@imag.fr

