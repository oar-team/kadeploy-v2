<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Kadepoy installation HOW-TO</title><link rel="stylesheet" href="style.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"><meta name="description" content="This HOW-TO deals about the installation methods of Kadeploy. Firstly we would explain how-to perform a parallel installation aside from the production instance of a previously installed Kadeploy, and secondly how to perform a production installation of Kadeploy 2.1.7."></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="kadeploy_installation_howto"></a>Kadepoy installation HOW-TO</h2></div><div><div class="author"><h3 class="author"><span class="firstname">Benjamin</span> <span class="surname">DEXHEIMER</span></h3></div></div><div><p class="releaseinfo">0.1</p></div><div><div class="abstract"><p class="title"><b>Abstract</b></p><p>
This HOW-TO deals about the installation methods of Kadeploy. Firstly we would explain how-to perform a parallel installation aside from the production instance of a previously installed Kadeploy, and secondly how to perform a production installation of Kadeploy 2.1.7.
			</p></div></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#parallel_install">1. How-to perform a parallel installation</a></span></dt><dd><dl><dt><span class="sect2"><a href="#prerequisites">1.1. Pre-requisites</a></span></dt><dt><span class="sect2"><a href="#217install">1.2. Kadeploy 2.1.7 installation</a></span></dt></dl></dd><dt><span class="sect1"><a href="#migration">2. How-to perform a migration from 2.1.6 to 2.1.7</a></span></dt></dl></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="parallel_install"></a>1. How-to perform a parallel installation</h2></div></div></div><p>
This part explains how-to have at the same time a testing-purpose instance of Kadeploy aside from the production instance.
		</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="prerequisites"></a>1.1. Pre-requisites</h3></div></div></div><p>
The Kadeploy commands suite cannot handle a customized configuration path, which is set by default at <code class="filename">/etc/kadeploy</code>. It implies to use a second server so as to have at the same time a production and a testing-purpose instance of Kadeploy. 
			</p><p>
From now, the frontend machine hosting the production-class Kadeploy will be designated by <span class="emphasis"><em>frontend-prod</em></span> and the frontend hosting the testing version will be designated by <span class="emphasis"><em>frontend-dev</em></span>.
			</p><p>
Kadeploy needs several resources :
			</p><div class="itemizedlist"><ul type="disc"><li><p>rsh client</p></li><li><p>DHCP server</p></li><li><p>PXE booting environment (usually from Syslinux project) for booting nodes</p></li><li><p>TFTP server, and therefore a writeable access to root TFTP directory served by tftp daemon (e.g. <code class="filename">/var/lib/tftpboot</code> and its sub-directories)</p></li><li><p>MySQL database</p></li><li><p>File-system level read access to Grid'5000 deployable system images.</p></li></ul></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="rsh"></a>1.1.1. rsh client</h4></div></div></div><p>
Kadeploy requires the usage of a legacy rsh client. This could be somewhat problematic because rsh is not installed by default  anymore in modern Linux distributions, although rsh responds at CLI (but it's a symbolic link pointing to ssh client). In debian-like systems, you have to install the package <span class="emphasis"><em>rsh-client</em></span> to obtain the real rsh client.
				</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="dhcp"></a>1.1.2. DHCP</h4></div></div></div><p>
Because of nature of DHCP, it's rather difficult to have side by side 2 servers handling the same set of nodes but with different configuration. That's why nodes used during Kadeploy tests will be booted with the same DHCP as for production use.
				</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="tftppxe"></a>1.1.3. TFTP and PXELinux</h4></div></div></div><p>
Because of <a href="#dhcp" title="1.1.2. DHCP">previous DHCP configuration</a>, the testing instance of Kadeploy will use the same TFTP server and therefore, the testing and production instances need to write PXE files at the same place. 
				</p><p>
The steps to follow are :
				</p><div class="orderedlist"><ol type="1"><li><p>
Install a NFS server on frontend hosting TFTP service.
						</p></li><li><p>
Make export root TFTP directory (cf <code class="filename">/etc/exports</code>) from this frontend.
						</p></li><li><p>
On frontend-dev : import the previously exported root TFTP directory.
						</p></li></ol></div><p>

The PXE environment is usually set by the cluster sysadmin in accordance with the TFTP installation layout. PXE related files and directories are likely to be located under TFTP root directory (cf <code class="filename">pxelinux.0</code> bootloader and <code class="filename">pxelinux.cfg</code> directory containing the boot configuration for the nodes). If TFTP root directory is NFS-mounted by frontend-dev, it will have access to PXE ressources, too.
				</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="mysql"></a>1.1.4. MySQL database</h4></div></div></div><p>
<span class="application">Kadeploy</span> needs an access as root and deploy user to a MySQL instance. Make sure your MySQL running server is reachable from frontend-dev using the MySQL root user. 
For instance, the following command should be working from frontend-dev : 
</p><pre class="programlisting">
	mysql -u root -p -h mysql.&lt;site&gt;.grid5000.fr
</pre><p>
				</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="images"></a>1.1.5. Grid'5000 images</h4></div></div></div><p>
Kadeploy needs a direct file-system access to deployable system images. The <code class="filename">/grid5000</code> directory have to be NFS mounted by fronted-dev.
				</p></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="217install"></a>1.2. Kadeploy 2.1.7 installation</h3></div></div></div><p>
The frontend considered for this installation is <span class="emphasis"><em>frontend-dev</em></span>.
			</p><p>
Please follow the instructions below : 
			</p><div class="procedure"><ol type="1"><li><p>
Retrieve and unpack the tarball archive of Kadeploy 2.1.7 (<code class="filename">kadeploy-2.1.7.tar.gz</code>) into a safe location (e.g. your home directory).
					</p><pre class="programlisting">
cd &lt;path_to_unpack_kadeploy_archive&gt; &amp;&amp; tar -xvzf kadeploy-2.1.7.tar.gz
</pre></li><li><p>
Edit the heading variables of <code class="filename">Makefile</code> located at the top of Kadeploy archive.
					</p><ol type="a"><li><p>
Especially, the following variables :
							</p><div class="itemizedlist"><ul type="disc"><li><p>
<span><strong class="command">DISTRIB</strong></span> : your distribution name. It sets an installation path for Perl library used by Kadeploy. Recognized distributions are : debian4 (Debian Etch 4.x), Fedora Core 4. Another distribution will set to default pathname. 
									</p></li><li><p>
<span><strong class="command">PREFIX</strong></span> : the PREFIX for installation pathnames.
									</p></li></ul></div></li><li><p>
This variables may be of interest, too :
							</p><div class="itemizedlist"><ul type="disc"><li><p>
<span><strong class="command">KADEPLOYCONFDIR</strong></span> : where to place configuration files.
									</p></li><li><p>
<span><strong class="command">KADEPLOYHOMEDIR</strong></span> : where Kadeploy files are installed.
									</p></li><li><p>
<span><strong class="command">DEPLOYUSER</strong></span> and <span><strong class="command">DEPLOYGROUP</strong></span> : username and groupname of the identity used by Kadeploy to perform his work (instead of using the super-privileged user <span class="emphasis"><em>root</em></span>). The values <span class="emphasis"><em>deploy</em></span> for both variables are set by default.
									</p></li></ul></div></li></ol></li><li><p>
Install Kadeploy by using the command as <span class="emphasis"><em>root</em></span> : 
					</p><pre class="programlisting">
make kadeploy_install
</pre></li><li><p>
Make sure that UID/GID used for the <em class="replaceable"><code>deploy</code></em> user on frontend-dev are the same that those on frontend-prod. Otherwise, make changes accordingly on frontend-dev to get same UID/GID values on both machines. It's important for later file-system accesses 
					</p></li><li><p>
Get TFTP root directory and Grid'5000 deployable images repository NFS mounted on frontend-dev.
					</p></li><li><p>
Get your Kadeploy 2.1.7 configuration ready. A quick way to achieve this is to copy into the test kadeploy configuration directory all production configuration files and modify them. Some informations into this files will be needed by the next step.
					</p></li><li><p>
Setup the Kadeploy database. The goal is to have side by side the production DB and the test DB. Informations will be sync from production to test DB to get the test DB initialized and working-ready. The command to interact with the Kadeploy DB is <span><strong class="command">kadatabase</strong></span>. It will ask for several informations, as MySQL login and password, database names.
					</p><ol type="a"><li><p>
								Issue the following commands : 
							</p><div class="itemizedlist"><ul type="disc"><li><p>
<span><strong class="command">kadatabase --create-db-deploy-217</strong></span> : create a Kadeploy 2.1.7 empty database.
									</p></li><li><p>
<span><strong class="command">kadatabase --add-deploy-db-user</strong></span> : add the deploy DB user into the MySQL instance. This is the mysql user used by Kadeploy for getting access to his database. It may be different from the production deploy DB user.
									</p></li><li><p>
<span><strong class="command">kadatabase --dup-production-db</strong></span> : duplicate the production DB into the test DB. Both DB names will be asked during operation. After that, you will have a working-ready test DB.
									</p></li><li><p>
<span><strong class="command">kadatabase --dup-deployment-rights</strong></span> : duplicate deployment rights into test DB. To be used each time a OAR submission have been issued from the OAR frontend. It gives the test kadeploy rights to deploy on the reserved nodes.
									</p></li></ul></div></li></ol></li><li><p>
That's all folks !
					</p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><div class="itemizedlist"><ul type="disc"><li><p>
Remember to issue kadeploy commands from frontend-dev when you want to test the 2.1.7 version.	
							</p></li><li><p>
Remember to issue <span><strong class="command">kadatabase --dup-deployment-rights</strong></span> each time you get a OAR reservation.
							</p></li></ul></div></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="migration"></a>2. How-to perform a migration from 2.1.6 to 2.1.7</h2></div></div></div><p>TODO.</p></div></div></body></html>
